import"./closeWindow-BOCvx3Ut.js";/* empty css             */import{i as g}from"./tauriAPIhelper-CqjvmD2y.js";let i=[],h=!1,p=null;document.addEventListener("DOMContentLoaded",async()=>{H(),K(),await k()});function E(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function B(t){if(!t)return"-";try{return new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"})}catch{return t}}function _(t){const e=document.getElementById("mapelTableBody");e&&(e.innerHTML=t?'<tr><td colspan="5" style="text-align:center;padding:30px;">â³ Memuat data...</td></tr>':"")}async function k(){try{_(!0),i=await g("get_all_mapel")||[],i.sort((e,a)=>new Date(a.created_at)-new Date(e.created_at)),w()}catch(t){console.error(t),alert("âŒ Gagal memuat data mapel: "+t.message)}finally{_(!1)}}function w(){const t=document.getElementById("mapelTableBody");if(t){if(t.innerHTML="",!i.length){t.innerHTML='<tr><td colspan="5" style="text-align:center;color:#999;padding:30px;">ğŸ“­ Belum ada data mata pelajaran</td></tr>';return}i.forEach((e,a)=>{const n=document.createElement("tr");n.innerHTML=`
      <td>${a+1}</td>
      <td>${E(e.nama_mapel)}</td>
      <td>${e.kkm??"-"}</td>
      <td>${B(e.created_at)}</td>
      <td>
        <button class="btn-edit" data-id="${e.id}">âœï¸</button>
        <button class="btn-delete" data-id="${e.id}">ğŸ—‘ï¸</button>
      </td>
    `,t.appendChild(n)}),v()}}function v(){document.querySelectorAll(".btn-edit").forEach(t=>t.addEventListener("click",()=>F(parseInt(t.dataset.id)))),document.querySelectorAll(".btn-delete").forEach(t=>t.addEventListener("click",()=>G(parseInt(t.dataset.id))))}function H(){const t=document.getElementById("mapelForm");t&&t.addEventListener("submit",N);const e=document.getElementById("searchMapel");e&&e.addEventListener("input",a=>j(a.target.value))}function K(){const t=window.location.pathname.split("/").pop();document.querySelectorAll(".nav-item").forEach(e=>{const a=e.getAttribute("href");(t===a||t===""&&a==="index-mapel.html")&&e.classList.add("active")})}async function N(t){t.preventDefault();const e=document.getElementById("namaMapel").value.trim(),a=parseInt(document.getElementById("kkm").value);if(!e||e.length<3||e.length>100)return alert("âš ï¸ Nama mata pelajaran harus 3-100 karakter!");if(isNaN(a)||a<0||a>100)return alert("âš ï¸ KKM harus 0-100!");try{h&&p?(await g("update_mapel",{req:{id:p,nama_mapel:e,kkm:a}}),alert("âœ… Mapel berhasil diupdate!"),M()):(await g("add_mapel",{req:{nama_mapel:e,kkm:a}}),alert("âœ… Mapel berhasil ditambahkan!")),await k(),t.target.reset()}catch(n){console.error(n),alert("âŒ Gagal menyimpan mapel: "+n.message)}}function F(t){const e=i.find(c=>c.id===t);if(!e)return alert("âŒ Data tidak ditemukan!");h=!0,p=t,document.getElementById("namaMapel").value=e.nama_mapel,document.getElementById("kkm").value=e.kkm;const a=document.querySelector('#mapelForm button[type="submit"]');a.textContent="âœï¸ Update Mapel",a.style.background="#f39c12";let n=document.getElementById("cancelEditBtn");n||(n=document.createElement("button"),n.id="cancelEditBtn",n.type="button",n.textContent="âŒ Batal",n.style.cssText="background:#ff0000ff;color:white;margin-top:10px;width:100%;",n.addEventListener("click",M),a.parentNode.appendChild(n)),n.style.display="block"}function M(){h=!1,p=null,document.getElementById("mapelForm").reset();const t=document.querySelector('#mapelForm button[type="submit"]');t.textContent="ğŸ’¾ Simpan Mapel",t.style.background="";const e=document.getElementById("cancelEditBtn");e&&(e.style.display="none")}async function G(t){const e=i.find(a=>a.id===t);if(!e)return alert("âŒ Data tidak ditemukan!");if(confirm(`âš ï¸ Hapus mapel "${e.nama_mapel}"?`))try{await g("delete_mapel",t),alert("âœ… Mapel berhasil dihapus!"),h&&p===t&&M(),await k()}catch(a){console.error(a),alert("âŒ Gagal menghapus mapel: "+a.message)}}function j(t){const e=document.getElementById("mapelTableBody");if(e.innerHTML="",!t.trim())return w();const a=i.filter(n=>n.nama_mapel.toLowerCase().includes(t.toLowerCase()));if(!a.length){e.innerHTML=`<tr><td colspan="5" style="text-align:center;color:#999;padding:30px;">ğŸ” Tidak ada hasil untuk "${E(t)}"</td></tr>`;return}a.forEach((n,c)=>{const m=document.createElement("tr");m.innerHTML=`
      <td>${c+1}</td>
      <td>${E(n.nama_mapel)}</td>
      <td>${n.kkm??"-"}</td>
      <td>${B(n.created_at)}</td>
      <td>
        <button class="btn-edit" data-id="${n.id}">âœï¸</button>
        <button class="btn-delete" data-id="${n.id}">ğŸ—‘ï¸</button>
      </td>
    `,e.appendChild(m)}),v()}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("modalMapel"),e=new bootstrap.Modal(t),a=document.getElementById("mapelForm"),n=document.getElementById("mapelId"),c=document.getElementById("namaMapel"),m=document.getElementById("kkm"),I=document.getElementById("modalMapelTitle"),T=document.getElementById("btnSaveMapel"),L=document.getElementById("btnTambahMapel"),s=document.getElementById("mapelTableBody");let f=[];async function u(d,l={}){if(!window.__TAURI__||!window.__TAURI__.tauri)throw new Error("âŒ Tauri API belum dimuat. Pastikan withGlobalTauri: true di tauri.conf.json");return await window.__TAURI__.tauri.invoke(d,l)}async function y(){try{f=(await u("get_all_mapel")).data||[],x(f),C(f)}catch(d){console.error("âŒ Gagal load mapel:",d),alert("Gagal memuat data mapel. Cek console.")}}function x(d=[]){if(s.innerHTML="",!d.length){s.innerHTML='<tr><td colspan="5" class="text-center">ğŸ“š Belum ada data mapel</td></tr>';return}d.sort((l,r)=>new Date(r.created_at||0)-new Date(l.created_at||0)),d.forEach((l,r)=>{const o=document.createElement("tr");o.innerHTML=`
        <td>${r+1}</td>
        <td>${l.nama_mapel}</td>
        <td>${l.kkm}</td>
        <td>${l.created_at||"-"}</td>
        <td>
          <button class="btn btn-sm btn-warning btn-edit" data-id="${l.id}" type="button">âœ’ï¸</button>
          <button class="btn btn-sm btn-danger btn-delete" data-id="${l.id}" type="button">ğŸ—‘ï¸</button>
        </td>
      `,s.appendChild(o)}),s.querySelectorAll(".btn-edit").forEach(l=>l.addEventListener("click",$)),s.querySelectorAll(".btn-delete").forEach(l=>l.addEventListener("click",D))}function C(d=[]){const l=d.length,r=d.map(b=>b.kkm),o=r.length?(r.reduce((b,A)=>b+A,0)/r.length).toFixed(1):"0",S=r.length?Math.max(...r):"0",q=r.length?Math.min(...r):"0";document.getElementById("totalMapel").textContent=l,document.getElementById("avgKKM").textContent=o,document.getElementById("highestKKM").textContent=S,document.getElementById("lowestKKM").textContent=q}L.addEventListener("click",()=>{a.reset(),n.value="",I.textContent="Tambah Mata Pelajaran",e.show()}),T.addEventListener("click",async()=>{const d=n.value.trim(),l=c.value.trim(),r=parseInt(m.value.trim());if(!l||l.length<3||l.length>100)return alert("âš ï¸ Nama mapel harus 3-100 karakter!");if(isNaN(r)||r<0||r>100)return alert("âš ï¸ KKM harus 0-100!");try{d?(await u("update_mapel",{req:{id:parseInt(d),nama_mapel:l,kkm:r}}),alert("âœ… Mapel berhasil diupdate!")):(await u("add_mapel",{req:{nama_mapel:l,kkm:r}}),alert("âœ… Mapel berhasil ditambahkan!")),e.hide(),await y()}catch(o){console.error("âŒ Gagal simpan mapel:",o),alert("âŒ Terjadi kesalahan saat menyimpan data. Cek console.")}});async function $(d){const l=d.currentTarget.dataset.id;if(l)try{const o=(await u("get_mapel_by_id",{id:parseInt(l)})).data;if(!o)return alert("âŒ Data tidak ditemukan!");n.value=o.id,c.value=o.nama_mapel,m.value=o.kkm,I.textContent="Edit Mata Pelajaran",e.show()}catch(r){console.error("âŒ Gagal ambil data mapel:",r)}}async function D(d){const l=d.currentTarget.dataset.id;if(l&&confirm("âš ï¸ Yakin hapus mapel ini?"))try{await u("delete_mapel",{id:parseInt(l)}),alert("âœ… Mapel berhasil dihapus!"),await y()}catch(r){console.error("âŒ Gagal hapus mapel:",r)}}y()});console.log("âœ… Mapel UI FINAL-FINAL loaded");
